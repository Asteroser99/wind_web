<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="./img/logo.png" type="image/x-icon">
    <title>Filament winding</title>

    <!-- "three": "https://unpkg.com/three@v0.174.0/build/three.module.js",
    "three/addons/": "https://unpkg.com/three@v0.174.0/examples/jsm/" -->
    <script type="importmap">
        {
            "imports": {
              "three": "https://cdn.jsdelivr.net/npm/three@0.174.0/build/three.module.js",
              "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.174.0/examples/jsm/"
            }
        }
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>
    <script type="module" src="./window.js"></script>
    <link rel="stylesheet" href="./window.css">

    <script src="https://cdn.jsdelivr.net/npm/amazon-cognito-identity-js/dist/amazon-cognito-identity.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script type="module" src="./cognito.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom"></script>
    <script type="module" src="./chart.js"></script>

    <script async src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.4.0/axios.min.js"></script>

    <script type="module" src="./three.js"></script>
    <link rel="stylesheet" href="./three.css">

    <script type="module" src="./patterns.js"></script>

    <script type="module" src="./vessel.js"></script>

    <script type="module" src="./animate.js"></script>

</head>
<body>
    <div class="header">
        <div class="div-logo">
            <button id="button-vessel" class="head-tab-link active" onclick="openTab('vessel'  )">
                <img id="logo" src="./img/logo.gif" alt="Logo">
            </button>
        </div>
        <div class="title"><h1>Filament Winding</h1></div>
        <div class="buttons">
            <button id="helpToggle"  class="header-btn small toggle-button" data-function="toggleHelp" ><img src="./img/help.png"><br>Help</button>
            <button id="loginToggle" class="header-btn small toggle-button" data-function="toggleLogin"><img id="logImg" src="./img/logOff.png"><br>Account</button>
        </div>
    </div>

    <div class="main-container">
        <div class="tab-container">
            <div class="tabs">
                <!-- <button id="button-vessel"   class="tab-link active" onclick="openTab('vessel'  )">Vessel</button> -->
                <button id="button-mandrel"   class="tab-link" onclick="openTab('mandrel'  )">Mandrel</button>
                <button id="button-coil"      class="tab-link" onclick="openTab('coil'     )">Coil</button>
                <button id="button-patterns"  class="tab-link" onclick="openTab('patterns' )">Patterns</button>
                <button id="button-winding"   class="tab-link" onclick="openTab('winding'  )">Winding</button>
                <button id="button-thickness" class="tab-link" onclick="openTab('thickness')">Thickness</button>
            </div>

        </div>

        <div id="canvas-container">

            <div id="tabs-content" class="tabs-content">

                <!-- Vessel -->
                <div id="tab-vessel" class="tab-content">
                    <div id="actions-vessel">
                        <h3>Examples</h3>
                        <button id="vesselExample1" class="image-button" title="Load Example 1"><img src="./img/load.png">&nbsp;Example 1</button><br>
                        <!-- <button id="vesselExample2" class="image-button" title="Load Example 2"><img src="./img/load.png">&nbsp;Example 2</button><br> -->
                    </div>

                    <div id="file-vessel">
                        <button id="vesselSave" class="image-button" title="Save session">Save session&nbsp;<img src="./img/save.png"></button><br>

                        <button id="vesselLoad" class="image-button" title="Load session">Load session&nbsp;<img src="./img/load.png"></button><br>
                        <input id="vesselLoadInput" type="file" accept=".yaml" style="display: none;" />

                        <button class="image-button function-button" data-function="vesselClear" data-query="Do you want to clear the session data?" title="Clear session" >Clear session&nbsp;<img src="./img/clear.png"></button>
                    </div>
                    <div id="help-vessel"></div>
                </div>

                <!-- Mandrel -->
                <div id="tab-mandrel" class="tab-content">
                    <div id="actions-mandrel">
                        <h3>Layer</h3>
                        <label for="PartNumber">Part number:</label><br>
                        <input type="text" id="PartNumber" class="inputField"
                            value="Name"
                            title="Enter layer name"
                            style="text-align: left;"
                        ><br>

                        <label for="LayerNumber">Layer number:</label><br>
                        <input type="number" id="LayerNumber" class="inputField"
                            min="1" max="999" step="1" 
                            value="1" pattern="\d{1,0}(\.\d{1,0})?" 
                            title="Enter layer number"
                            style="text-align: right;"
                        ><br>
                    </div>

                    <div id="file-mandrel">
                        <button class="image-button function-button" data-function="mandrelImportCSV"  data-parameter="Raw" title="Raw mandrel import">Import mandrel&nbsp;<img src="./img/load.png"></button>
                        <div id="mandrel-csvColumn"></div>

                        <h3>Transform</h3>
                        <button id="mandrelSwap"     class="image-button small" title="Swap R/X">Swap&nbsp;<img src="./img/transform.png"></button><br>
                        <button id="mandrelReverse"  class="image-button small" title="Reverse" >Reverse&nbsp;<img src="./img/transform.png"></button><br>
                        <button id="mandrelRedirect" class="image-button small" title="Redirect">Redirect&nbsp;<img src="./img/transform.png"></button><br>
                        <button id="mandrelMirror"   class="image-button small" title="Mirror"  >Mirror&nbsp;<img src="./img/transform.png"></button><br>
                    </div>
                    <div id="help-mandrel"></div>
                </div>

                <!-- Coil -->
                <div id="tab-coil" class="tab-content">
                    <div id="actions-coil">
                        <label for="poleR">Pole &Ropf;:</label><br>
                        <input type="number" id="poleR" class="inputField"
                            min="0" max="999" step="0.001" 
                            value="10.000" pattern="\d{1,3}(\.\d{1,3})?" 
                            title="Enter pole radius"
                            style="text-align: right;"
                        ><br>

                        <label for="band">Band width:</label><br>
                        <input type="number" id="band" class="inputField" 
                            min="0" max="999" step="1.0" 
                            value="10.0" pattern="\d{1,3}(\.\d{1,3})?" 
                            title="Enter band width" 
                            style="text-align: right;" 
                        ><br>

                        <button id="coilCalc" class="image-button" title="Generate coil"><img src="./img/calc.png">&nbsp;Generate coil</button><br>
                    </div>

                    <div id="file-coil">
                        <!-- <button id="coilLoad" class="image-button" title="Load coil from yaml file">Load coil&nbsp;<img src="./img/load.png"></button>
                        <input id="coilLoadInput" type="file" accept=".yaml" style="display: none;" /> -->
                    </div>
                    <div id="help-coil"></div>
                </div>

                <!-- Patterns -->
                <div id="tab-patterns" class="tab-content">
                    <!-- <button id="patternsCalc" class="action-button">Get patterns</button> -->

                    <div id="actions-patterns" class="floatingControl">
                        <label for="conv">Convenience:</label><br>
                        <input type="number" id="conv" class="inputField" 
                            min="0" max="999" step="1.0" 
                            value="4.0" pattern="\d{1,3}(\.\d{1,3})?" 
                            title="Enter number of patterns" 
                            style="text-align: right;" 
                        ><br>
                        
                        <div class="hPanel">Net structure<input class="inputField" type="checkbox" id="netStructure" title="Net structure" value=false></div><br>

                        <label for="conv">Select pattern:</label><br>
                        <table id="data-table">
                            <thead>
                                <tr>
                                    <!-- <th>Turns</th> -->
                                    <th>Coils</th>
                                    <th>Corr. %</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>

                        <button id="coilCorrect" class="image-button" title="Correct coil"><img src="./img/calc.png">&nbsp;Correct coil</button><br>
                    </div>
                    <div id="help-patterns"></div>
                </div>

                <!-- Winding -->
                <div id="tab-winding" class="tab-content">
                    <div id="actions-winding">
                        <!-- <label for="testMode">Test mode:</label>
                        <input type="number" id="testMode" class="inputField"
                            min="0" max="9" step="1"
                            value="0" pattern="\d{1,0}"
                            title="Enter test mode"
                            style="text-align: right;"
                        >
                        <br> -->

                        <label for="safetyR">Safety &Ropf;:</label><br>
                        <input type="number" id="safetyR" class="inputField" 
                            min="0" max="999" step="0.1" 
                            value="50.0" pattern="\d{1,1}(\.\d{1,1})?"
                            title="Enter safety radius"
                            style="text-align: right;"
                        ><br>

                        <label for="lineCount">G-code length:</label><br>
                        <input type="number" id="lineCount" class="inputField" 
                            min="0" max="9999" step="1"
                            value="1500" pattern="\d{1,0}"
                            title="Enter G-code line count"
                            style="text-align: right;"
                        ><br>

                        <button
                            class="image-button function-button"
                            data-function="Winding"
                            title="Winding"
                        ><img src="./img/calc.png">&nbsp;Winding</button><br>
                    </div>

                    <div id="file-winding">
                        <button id="CNCExport" class="image-button" title="Download CNC">Download CNC&nbsp;<img src="./img/save.png"></button>
                    </div>
                    <div id="help-winding"></div>
                </div>

                <!-- Thickness -->
                <div id="tab-thickness" class="tab-content">
                    <div id="actions-thickness">
                        <button id="thicknessGet"  class="image-button" title="Get thickness"><img src="./img/calc.png">&nbsp;Get thickness</button><br>
                        <button id="mandrelSmooth" class="image-button" title="Smooth raw mandrel"><img src="./img/calc.png">&nbsp;Smooth</button><br>
                    </div>

                    <div id="file-thickness">
                        <div id="file-mandrel-import-export">
                            <h3>Import/Export</h3>

                            <div>
                                <div id="thickness-csvColumn">
                                    <div id="div-csvColumn">
                                        <label for="csvColumn">CSV column:</label>
                                        <input type="number" value="1" min="1" step="1" id="csvColumn" class="inputField" style="text-align: right; width: 30px" title="Column number, if there more than one columns of data in .csv file">
                                        <br>

                                        <input id="mandrelImportCSVInput" type="file" accept=".csv" style="display: none;" />
                                    </div>
                                </div>

                                <div id="file-mandrel-import-export-raw">
                                    Raw
                                    <button class="image-button small function-button" data-function="mandrelImportCSV"  data-parameter="Raw" title="Raw mandrel import"><img src="./img/load.png"></button>
                                    <button class="image-button small function-button" data-function="saveCsvWithDialog" data-parameter="Raw" title="Raw mandrel export"><img src="./img/save.png"></button>
                                    <button class="image-button small function-button" data-function="mandrelClear"      data-parameter="Raw" data-query="Do you want to clear the mandrel?" title="Raw mandrel clear" ><img src="./img/clear.png"></button>
                                </div>

                                <div id="file-mandrel-import-export-thickness">
                                    Winded
                                    <button class="image-button small function-button" data-function="mandrelImportCSV"  data-parameter="Winded" title="Winded mandrel import"><img src="./img/load.png"></button>
                                    <button class="image-button small function-button" data-function="saveCsvWithDialog" data-parameter="Winded" title="Winded mandrel export"><img src="./img/save.png"></button>
                                    <button class="image-button small function-button" data-function="mandrelClear"      data-parameter="Winded" data-query="Do you want to clear the mandrel?" title="Winded mandrel clear" ><img src="./img/clear.png"></button>
                                </div>

                                <div id="file-mandrel-import-export-smoothed">
                                    Smoothed
                                    <button class="image-button small function-button" data-function="mandrelImportCSV"  data-parameter="Smoothed" title="Smoothed mandrel import"><img src="./img/load.png"></button>
                                    <button class="image-button small function-button" data-function="saveCsvWithDialog" data-parameter="Smoothed" title="Smoothed mandrel export"><img src="./img/save.png"></button>
                                    <button class="image-button small function-button" data-function="mandrelClear"      data-parameter="Smoothed" data-query="Do you want to clear the mandrel?" title="Smoothed mandrel clear" ><img src="./img/clear.png"></button>
                                </div>

                            </div>
                        </div>
                    </div>
                    <div id="help-thickness"></div>
                </div>

            </div>

            <!-- Mandrel chart -->
            <div id="mandrel-canvas-div" class="static-content">
                <canvas id="mandrel-canvas"></canvas>
            </div>

            <!-- Patterns canvas -->
            <div id="patterns-canvas-div" class="static-content">
                <canvas id="patterns-canvas"></canvas>
            </div>

            <!-- 3D Three scene -->
            <div id="scene-canvas-div" class="static-content active">
                <canvas id="scene-canvas"></canvas>
                <div class="animateControls">
                    <div id="programBar">
                        <p class="program-p"></p>
                    </div>
                    <div id="playerBar">
                        <button id="animateButton" class="animate-button"></button>
                        <input type="range" id="animateSlider" min="0" max="100" step="1" value="0">
                    </div>
                    <div id="modeBar">
                        <div>
                            <button class="mode-button active" data-mode="first">First coil</button>
                            <button class="mode-button" data-mode="round">First round</button>
                            <button class="mode-button" data-mode="all">Full winding</button>
                        </div>
                        <div>
                            <button class="toggle-button active" data-function="toggleMandrel">Mandrel</button>
                            <button class="toggle-button" data-function="toggleLine">Line</button>
                            <button class="toggle-button active" data-function="toggleTape">Tape</button>
                            <button class="toggle-button" data-function="toggleEquidistanta">Equidistanta</button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="info-canvas-div" class="static-content">
            </div>
    
            <div id="actions-container">
            </div>
    
            <div id="file-container">
            </div>
    
            <div id="scene-thumbnail-container">
                <canvas id="scene-thumbnail"></canvas>
            </div>
    
            <div id="help-container">
                <button id="helpCloseButton" class="closeButton toggle-button" data-function="toggleHelp" >&times;</button>
            </div>

            <input type="file" id="fileInput" style="display: none;">
        </div>

        <div id="loginContainer">
            <div id="loggedInContainer" class="vPanel">
                <div class="hPanel">
                    <img class="icon-img mid" src="./img/logIn.png">
                    <h3>Signed in</h3>
                </div>

                <table>
                    <tr><td>E-mail: </td><td><div class="hPanel" id="cognitoEMail"    class="user-logged"></div></td></tr>
                    <tr><td>Signed in: </td><td><div class="hPanel" id="cognitoAuthTime" class="user-logged"></div></td></tr>
                    <tr><td>Expires:</td><td><div class="hPanel" id="cognitoExpires"  class="user-logged"></div></td></tr>
                </table>

                <button class="image-button small function-button" data-function="cognitoLogOff" title="Sign out"><img src="./img/logOff.png">&nbsp;Sign out</button>

                <hr>
                <div id="SubscriptionExist" class="vPanel" style="display:none">
                    <div class="hPanel">
                        <img class="icon-img mid" src="./img/subscribe.png">
                        <h3>Subscription:</h3>
                    </div>
                    <div id="subscriptionDescription"></div>
                    <div id="reNewOn" class="hPanel">
                        <button class="image-button function-button small" data-function="stripeRenew" data-parameter="Off" data-query="If auto-renewal is disabled, after the subscription is completed, the next payment will not be charged and the subscription will not be renewed. Only subscribed users have access to the calculation functions. Are you sure you want to turn off auto-renewal?" title=""><img src="./img/reNewOff.png">&nbsp;Turn off auto-renewal</button>
                    </div>
                    <div id="reNewOff" class="hPanel">
                        <button class="image-button function-button small" data-function="stripeRenew" data-parameter="On" data-query="If auto-renewal is enabled, after the subscription is completed, the next payment will be charged and the subscription will be renewed. Are you sure you want to turn on auto-renewal?" title=""><img src="./img/reNewOn.png">&nbsp;Turn on auto-renewal</button>
                    </div>
                </div>
                <div id="SubscriptionNotExist" class="vPanel" style="display:none">
                    <div class="hPanel">
                        <h3>Subscription</h3>
                    </div>
                    <p>Please subscribe to use</p>
                    <p>the calculation functions</p>
                    <button class="image-button function-button" data-function="stripeSubscribe"   title=""><img src="./img/subscribe.png" >&nbsp;Subscribe</button>
                    <!-- <div class="hPanel"><input type="checkbox" id="cbAutoRenewal" title="If auto-renewal is enabled, after the subscription is completed, the next payment will be charged and the subscription will be renewed.">Auto-renew</div> -->
                </div>

            </div>

            <div id="loggedOffContainer">
                <div class="hPanel">
                    <img class="icon-img mid" src="./img/logOff.png">
                    <h3>Signed out</h3>
                </div>
                <button class="image-button function-button" data-function="cognitoLogIn"  title="Sign in" ><img src="./img/logIn.png" >&nbsp;Sign in</button>
            </div>

            <button id="impressumToggle" class="toggle-button" data-function="toggleImpressum"  title="Impressum und Datenschutzerklärung" >Impressum und<br>Datenschutzerklärung</button>

            <button id="loginCloseButton" class="closeButton toggle-button" data-function="toggleLogin" >&times;</button>
        </div>

        <div id="impressumContainer" class="vPanel">
            <div id="impressum-text" class="vPanel"></div>
            <button id="impressumCloseButton" class="closeButton toggle-button" data-function="toggleImpressum" >&times;</button>
        </div>
    </div>

    <div id="modal-overlay" class="modal-overlay">
        <div id="modal" class="modal">
            <p id="modal-text"></p>
            <div class="modal-buttons">
                <button id="questionYes">Yes</button>
                <button id="questionNo" >No</button>
            </div>
        </div>
    </div>

</body>
</html>
